# å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå­¦ä¹ æ€»ç»“

**ä½œè€…**: QSH
**é¡¹ç›®**: åŸºäºPyAutoGençš„å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ
**æ—¥æœŸ**: 2026-02-13

---

## ğŸ“š ç›®å½•

1. [AutoGenå·¥ä½œåŸç†](#1-autogenå·¥ä½œåŸç†)
2. [RAGå·¥ä½œåŸç†](#2-ragå·¥ä½œåŸç†)
3. [å¼‚æ­¥ç¼–ç¨‹ï¼ˆasync/awaitï¼‰](#3-å¼‚æ­¥ç¼–ç¨‹asyncawait)
4. [é¡¹ç›®å®è·µæ€»ç»“](#4-é¡¹ç›®å®è·µæ€»ç»“)
5. [å­¦ä¹ å¿ƒå¾—](#5-å­¦ä¹ å¿ƒå¾—)

---

## 1. AutoGenå·¥ä½œåŸç†

### 1.1 ä»€ä¹ˆæ˜¯AutoGenï¼Ÿ

**PyAutoGen** æ˜¯å¾®è½¯å¼€æºçš„å¤šæ™ºèƒ½ä½“æ¡†æ¶ï¼Œå®ƒå…è®¸å¤šä¸ªAIæ™ºèƒ½ä½“ï¼ˆAgentsï¼‰ç›¸äº’åä½œå®Œæˆå¤æ‚ä»»åŠ¡ã€‚

### 1.2 æ ¸å¿ƒæ¦‚å¿µ

#### 1.2.1 Agentï¼ˆæ™ºèƒ½ä½“ï¼‰

AutoGenä¸­æœ‰ä¸¤ç§ä¸»è¦çš„Agentï¼š

**AssistantAgentï¼ˆåŠ©æ‰‹æ™ºèƒ½ä½“ï¼‰**
- è¿æ¥åˆ°LLMï¼ˆå¦‚DeepSeekã€GPT-4ç­‰ï¼‰
- è´Ÿè´£ç†è§£ä»»åŠ¡ã€ç”Ÿæˆä»£ç ã€å›ç­”é—®é¢˜
- å¯ä»¥è°ƒç”¨å·¥å…·å‡½æ•°

**UserProxyAgentï¼ˆç”¨æˆ·ä»£ç†æ™ºèƒ½ä½“ï¼‰**
- ä»£è¡¨ç”¨æˆ·æ‰§è¡Œæ“ä½œ
- è´Ÿè´£æ‰§è¡Œä»£ç 
- ç®¡ç†å¯¹è¯æµç¨‹

#### 1.2.2 å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UserProxy  â”‚ â”€â”€æ¶ˆæ¯â”€â”€> â”‚  Assistant   â”‚
â”‚   (ç”¨æˆ·)    â”‚         â”‚   (AIåŠ©æ‰‹)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘                        â”‚
      â”‚                        â”‚
      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
      â””â”€â”€â”€â”€â”€â”€â”‚  LLM    â”‚<â”€â”€â”€â”€â”€â”€â”˜
             â”‚(DeepSeek)â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…¸å‹å¯¹è¯æµç¨‹**ï¼š

1. **UserProxy å‘èµ·ä»»åŠ¡**
   ```python
   user_proxy.initiate_chat(
       assistant,
       message="è¯·è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—å‰20é¡¹"
   )
   ```

2. **Assistant ç†è§£ä»»åŠ¡å¹¶ç”Ÿæˆä»£ç **
   - LLMåˆ†æä»»åŠ¡éœ€æ±‚
   - ç”ŸæˆPythonä»£ç 
   - è¿”å›ä»£ç å—

3. **UserProxy æ‰§è¡Œä»£ç **
   - åœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œä»£ç 
   - æ•è·è¾“å‡ºç»“æœ
   - ï¿½ï¿½å›æ‰§è¡Œç»“æœ

4. **å¾ªç¯è¿­ä»£**
   - å¦‚æœä»»åŠ¡æœªå®Œæˆï¼Œç»§ç»­å¯¹è¯
   - ç›´åˆ°æ”¶åˆ°"TERMINATE"ä¿¡å·

### 1.3 é¡¹ç›®ä¸­çš„å®ç°

#### åˆ›å»ºAgent

```python
# agents/agent_factory.py

# åˆ›å»ºAssistantï¼ˆAIåŠ©æ‰‹ï¼‰
assistant = AssistantAgent(
    name="Assistant",
    system_message="ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹...",
    llm_config=llm_config,  # LLMé…ç½®
)

# åˆ›å»ºUserProxyï¼ˆç”¨æˆ·ä»£ç†ï¼‰
user_proxy = UserProxyAgent(
    name="UserProxy",
    human_input_mode="NEVER",  # è‡ªåŠ¨æ¨¡å¼
    code_execution_config={
        "work_dir": "workspace",  # ä»£ç æ‰§è¡Œç›®å½•
        "use_docker": False,      # ä¸ä½¿ç”¨Docker
    },
)
```

#### æ³¨å†Œå·¥å…·å‡½æ•°

AutoGenå…è®¸Agentè°ƒç”¨è‡ªå®šä¹‰å·¥å…·ï¼š

```python
# tools/knowledge_base.py

def query_knowledge_base(question: str) -> str:
    """æŸ¥è¯¢çŸ¥è¯†åº“å·¥å…·"""
    rag_system = get_rag_instance()
    context = rag_system.query(question, n_results=5)
    return f"ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š\n{context}"

# æ³¨å†Œå·¥å…·
assistant.register_for_llm(
    name="query_knowledge_base",
    description="æŸ¥è¯¢çŸ¥è¯†åº“ä»¥è·å–å…³äº QSH çš„ä¸ªäººä¿¡æ¯"
)(query_knowledge_base)

user_proxy.register_for_execution(
    name="query_knowledge_base"
)(query_knowledge_base)
```

### 1.4 AutoGençš„ä¼˜åŠ¿

1. **è‡ªåŠ¨åŒ–å¯¹è¯ç®¡ç†**: è‡ªåŠ¨å¤„ç†å¤šè½®å¯¹è¯
2. **ä»£ç æ‰§è¡Œ**: å†…ç½®ä»£ç æ‰§è¡Œç¯å¢ƒ
3. **å·¥å…·é›†æˆ**: è½»æ¾é›†æˆå¤–éƒ¨å·¥å…·å’ŒAPI
4. **çµæ´»é…ç½®**: æ”¯æŒå¤šç§LLMåç«¯

---

## 2. RAGå·¥ä½œåŸç†

### 2.1 ä»€ä¹ˆæ˜¯RAGï¼Ÿ

**RAG (Retrieval-Augmented Generation)** = æ£€ç´¢å¢å¼ºç”Ÿæˆ

RAGæ˜¯ä¸€ç§ç»“åˆäº†**ä¿¡æ¯æ£€ç´¢**å’Œ**æ–‡æœ¬ç”Ÿæˆ**çš„æŠ€æœ¯ï¼Œè®©LLMèƒ½å¤Ÿè®¿é—®å¤–éƒ¨çŸ¥è¯†åº“ã€‚

### 2.2 ä¸ºä»€ä¹ˆéœ€è¦RAGï¼Ÿ

**LLMçš„å±€é™æ€§**ï¼š
- âŒ çŸ¥è¯†æˆªæ­¢æ—¥æœŸï¼ˆè®­ç»ƒæ•°æ®æœ‰æ—¶é—´é™åˆ¶ï¼‰
- âŒ æ— æ³•è®¿é—®ç§æœ‰æ•°æ®
- âŒ å¯èƒ½äº§ç”Ÿå¹»è§‰ï¼ˆç¼–é€ ä¸å­˜åœ¨çš„ä¿¡æ¯ï¼‰

**RAGçš„è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… å®æ—¶æ£€ç´¢æœ€æ–°ä¿¡æ¯
- âœ… è®¿é—®ç§æœ‰çŸ¥è¯†åº“
- âœ… åŸºäºäº‹å®å›ç­”ï¼Œå‡å°‘å¹»è§‰

### 2.3 RAGå·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·é—®é¢˜    â”‚
â”‚ "QSHå–œæ¬¢ä»€ä¹ˆï¼Ÿ"â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. å‘é‡åŒ–é—®é¢˜   â”‚  â† Embeddingæ¨¡å‹
â”‚  [0.2, 0.5, ...] â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. å‘é‡æ£€ç´¢     â”‚  â† ChromaDB
â”‚  æ‰¾åˆ°æœ€ç›¸ä¼¼çš„æ–‡æ¡£ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. è¿”å›ç›¸å…³æ–‡æ¡£ â”‚
â”‚ "QSHå–œæ¬¢ç¯®çƒ..." â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. LLMç”Ÿæˆå›ç­”  â”‚  â† åŸºäºæ£€ç´¢åˆ°çš„å†…å®¹
â”‚ "æ ¹æ®çŸ¥è¯†åº“ï¼ŒQSH â”‚
â”‚  å–œæ¬¢æ‰“ç¯®çƒ"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æ ¸å¿ƒç»„ä»¶

#### 2.4.1 Embeddingæ¨¡å‹

**ä½œç”¨**: å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼ˆæ•°å­—æ•°ç»„ï¼‰

```python
from sentence_transformers import SentenceTransformer

# åŠ è½½æ¨¡å‹
model = SentenceTransformer('all-MiniLM-L6-v2')

# æ–‡æœ¬å‘é‡åŒ–
text = "QSHå–œæ¬¢æ‰“ç¯®çƒ"
vector = model.encode(text)
# ç»“æœ: [0.234, -0.123, 0.567, ...]  (384ç»´å‘é‡)
```

**ä¸ºä»€ä¹ˆéœ€è¦å‘é‡åŒ–ï¼Ÿ**
- è®¡ç®—æœºæ— æ³•ç›´æ¥ç†è§£æ–‡æœ¬
- å‘é‡å¯ä»¥è®¡ç®—ç›¸ä¼¼åº¦
- ç›¸ä¼¼çš„æ–‡æœ¬ä¼šæœ‰ç›¸ä¼¼çš„å‘é‡

#### 2.4.2 å‘é‡æ•°æ®åº“ï¼ˆChromaDBï¼‰

**ä½œç”¨**: å­˜å‚¨å’Œæ£€ç´¢å‘é‡

```python
import chromadb

# åˆå§‹åŒ–æ•°æ®åº“
client = chromadb.PersistentClient(path="./chroma_db")
collection = client.get_or_create_collection("knowledge_base")

# æ·»åŠ æ–‡æ¡£
collection.add(
    ids=["doc_1"],
    embeddings=[[0.234, -0.123, ...]],  # å‘é‡
    documents=["QSHå–œæ¬¢æ‰“ç¯®çƒ"],         # åŸå§‹æ–‡æœ¬
)

# æ£€ç´¢ç›¸ä¼¼æ–‡æ¡£
results = collection.query(
    query_embeddings=[[0.240, -0.120, ...]],  # é—®é¢˜çš„å‘é‡
    n_results=3  # è¿”å›æœ€ç›¸ä¼¼çš„3æ¡
)
```

### 2.5 é¡¹ç›®ä¸­çš„å®ç°

#### 2.5.1 RAGç³»ç»Ÿåˆå§‹åŒ–

```python
# rag/rag_system_optimized.py

class RAGSystemOptimized:
    def __init__(self):
        # 1. åŠ è½½Embeddingæ¨¡å‹
        self.embedding_model = SentenceTransformer('all-MiniLM-L6-v2')

        # 2. åˆå§‹åŒ–ChromaDB
        self.chroma_client = chromadb.PersistentClient(path="./chroma_db")

        # 3. åˆ›å»ºé›†åˆ
        self.collection = self.chroma_client.get_or_create_collection(
            name="qsh_knowledge_base"
        )
```

#### 2.5.2 æ·»åŠ æ–‡æ¡£ï¼ˆæ‰¹é‡å¤„ç†ä¼˜åŒ–ï¼‰

```python
def add_document(self, doc_path: str, batch_size: int = 32):
    # è¯»å–æ–‡æ¡£
    with open(doc_path, 'r', encoding='utf-8') as f:
        content = f.read()

    # åˆ†å‰²æˆæ®µè½
    paragraphs = [p.strip() for p in content.split('\n') if p.strip()]

    # æ‰¹é‡å¤„ç†ï¼ˆå…³é”®ä¼˜åŒ–ç‚¹ï¼‰
    for i in range(0, len(paragraphs), batch_size):
        batch = paragraphs[i:i + batch_size]

        # æ‰¹é‡ç”Ÿæˆembeddingsï¼ˆä¸€æ¬¡å¤„ç†å¤šä¸ªï¼‰
        embeddings = self.embedding_model.encode(batch)

        # æ‰¹é‡æ’å…¥æ•°æ®åº“
        self.collection.add(
            ids=[f"doc_{i+j}" for j in range(len(batch))],
            embeddings=embeddings.tolist(),
            documents=batch,
        )
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
- åŸå§‹ç‰ˆæœ¬ï¼ˆé€ä¸ªå¤„ç†ï¼‰ï¼š10ä¸ªæ®µè½ â‰ˆ 2-3ç§’
- ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆæ‰¹é‡å¤„ç†ï¼‰ï¼š10ä¸ªæ®µè½ â‰ˆ 0.5-1ç§’
- **æå‡**: 3-5å€

#### 2.5.3 æŸ¥è¯¢çŸ¥è¯†åº“

```python
def query(self, question: str, n_results: int = 3) -> str:
    # 1. å°†é—®é¢˜å‘é‡åŒ–
    question_embedding = self.embedding_model.encode(question).tolist()

    # 2. åœ¨æ•°æ®åº“ä¸­æ£€ç´¢
    results = self.collection.query(
        query_embeddings=[question_embedding],
        n_results=n_results
    )

    # 3. è¿”å›æ£€ç´¢åˆ°çš„æ–‡æ¡£
    documents = results['documents'][0]
    return "\n".join(documents)
```

### 2.6 RAGçš„å…³é”®æŠ€æœ¯

1. **è¯­ä¹‰ç›¸ä¼¼åº¦**: åŸºäºå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦
2. **æ‰¹é‡å¤„ç†**: å‡å°‘æ¨¡å‹è°ƒç”¨æ¬¡æ•°
3. **æŒä¹…åŒ–å­˜å‚¨**: ChromaDBè‡ªåŠ¨ä¿å­˜æ•°æ®
4. **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡æ–‡æ¡£æ£€ç´¢

---

## 3. å¼‚æ­¥ç¼–ç¨‹ï¼ˆasync/awaitï¼‰

### 3.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹ï¼Ÿ

**åŒæ­¥ vs å¼‚æ­¥**ï¼š

**åŒæ­¥ï¼ˆSynchronousï¼‰**ï¼š
```python
# å¿…é¡»ç­‰å¾…æ¯ä¸ªä»»åŠ¡å®Œæˆ
result1 = task1()  # ç­‰å¾…2ç§’
result2 = task2()  # ç­‰å¾…2ç§’
result3 = task3()  # ç­‰å¾…2ç§’
# æ€»æ—¶é—´: 6ç§’
```

**å¼‚æ­¥ï¼ˆAsynchronousï¼‰**ï¼š
```python
# å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡
result1 = await task1()  # å¼€å§‹task1ï¼Œä¸é˜»å¡
result2 = await task2()  # å¼€å§‹task2ï¼Œä¸é˜»å¡
result3 = await task3()  # å¼€å§‹task3ï¼Œä¸é˜»å¡
# æ€»æ—¶é—´: çº¦2ç§’ï¼ˆå¦‚æœä»»åŠ¡å¯ä»¥å¹¶è¡Œï¼‰
```

### 3.2 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ

**I/Oå¯†é›†å‹æ“ä½œ**ï¼š
- ç½‘ç»œè¯·æ±‚ï¼ˆAPIè°ƒç”¨ï¼‰
- æ–‡ä»¶è¯»å†™
- æ•°æ®åº“æŸ¥è¯¢

è¿™äº›æ“ä½œå¤§éƒ¨åˆ†æ—¶é—´åœ¨**ç­‰å¾…**ï¼Œè€Œä¸æ˜¯è®¡ç®—ã€‚å¼‚æ­¥ç¼–ç¨‹å¯ä»¥åœ¨ç­‰å¾…æœŸé—´æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚

### 3.3 async/await è¯­æ³•

#### 3.3.1 å®šä¹‰å¼‚æ­¥å‡½æ•°

```python
# åŒæ­¥å‡½æ•°
def normal_function():
    return "Hello"

# å¼‚æ­¥å‡½æ•°ï¼ˆä½¿ç”¨asyncå…³é”®å­—ï¼‰
async def async_function():
    return "Hello"
```

#### 3.3.2 è°ƒç”¨å¼‚æ­¥å‡½æ•°

```python
# âŒ é”™è¯¯ï¼šä¸èƒ½ç›´æ¥è°ƒç”¨
result = async_function()  # è¿”å›åç¨‹å¯¹è±¡ï¼Œä¸æ˜¯ç»“æœ

# âœ… æ­£ç¡®ï¼šä½¿ç”¨await
result = await async_function()  # ç­‰å¾…å¹¶è·å–ç»“æœ
```

#### 3.3.3 è¿è¡Œå¼‚æ­¥ç¨‹åº

```python
import asyncio

async def main():
    result = await async_function()
    print(result)

# è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°
asyncio.run(main())
```

### 3.4 é¡¹ç›®ä¸­çš„å®ç°

#### 3.4.1 å¼‚æ­¥ä»»åŠ¡å‡½æ•°

```python
# tasks/fibonacci_task.py

async def run_fibonacci_task(assistant, user_proxy, output_dir: str = "workspace"):
    """
    æ‰§è¡Œæ–æ³¢é‚£å¥‘ä»»åŠ¡ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰
    """
    task_message = """
    è¯·è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—å‰20é¡¹å¹¶ç”Ÿæˆå›¾è¡¨...
    """

    # ä½¿ç”¨awaitè°ƒç”¨å¼‚æ­¥æ–¹æ³•
    await user_proxy.a_initiate_chat(
        assistant,
        message=task_message,
        clear_history=True,
    )
```

**å…³é”®ç‚¹**ï¼š
- `async def` å®šä¹‰å¼‚æ­¥å‡½æ•°
- `await` ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
- `a_initiate_chat` æ˜¯AutoGençš„å¼‚æ­¥æ–¹æ³•ï¼ˆæ³¨æ„å‰ç¼€`a_`ï¼‰

#### 3.4.2 å¼‚æ­¥ä¸»å‡½æ•°

```python
# main.py

async def main():
    """ä¸»å‡½æ•°ï¼ˆå¼‚æ­¥ç‰ˆæœ¬ï¼‰"""

    # åˆå§‹åŒ–ï¼ˆåŒæ­¥æ“ä½œï¼‰
    init_rag_system()
    assistant, user_proxy = create_agents()

    # æ‰§è¡Œä»»åŠ¡ï¼ˆå¼‚æ­¥æ“ä½œï¼‰
    await run_fibonacci_task(assistant, user_proxy)
    await run_qa_task(assistant, user_proxy)

# è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°
if __name__ == "__main__":
    asyncio.run(main())
```

### 3.5 å¼‚æ­¥ç¼–ç¨‹çš„æ³¨æ„äº‹é¡¹

#### âœ… æ­£ç¡®ç”¨æ³•

```python
# 1. å¼‚æ­¥å‡½æ•°å¿…é¡»ç”¨async defå®šä¹‰
async def my_function():
    pass

# 2. awaitåªèƒ½åœ¨asyncå‡½æ•°ä¸­ä½¿ç”¨
async def caller():
    result = await my_function()

# 3. ä½¿ç”¨asyncio.run()è¿è¡Œ
asyncio.run(caller())
```

#### âŒ å¸¸è§é”™è¯¯

```python
# é”™è¯¯1ï¼šåœ¨éasyncå‡½æ•°ä¸­ä½¿ç”¨await
def normal_function():
    result = await async_function()  # âŒ è¯­æ³•é”™è¯¯

# é”™è¯¯2ï¼šå¿˜è®°ä½¿ç”¨await
async def caller():
    result = async_function()  # âŒ è¿”å›åç¨‹å¯¹è±¡ï¼Œä¸æ˜¯ç»“æœ

# é”™è¯¯3ï¼šå¯¹åŒæ­¥å‡½æ•°ä½¿ç”¨await
async def caller():
    result = await normal_function()  # âŒ ä¸èƒ½awaitåŒæ­¥å‡½æ•°
```

### 3.6 å¼‚æ­¥ vs åŒæ­¥å¯¹æ¯”

| ç‰¹æ€§ | åŒæ­¥ | å¼‚æ­¥ |
|------|------|------|
| **å®šä¹‰** | `def function()` | `async def function()` |
| **è°ƒç”¨** | `result = function()` | `result = await function()` |
| **è¿è¡Œ** | ç›´æ¥è°ƒç”¨ | `asyncio.run(function())` |
| **é˜»å¡** | ä¼šé˜»å¡ | ä¸é˜»å¡ï¼ˆå¯ä»¥åˆ‡æ¢ä»»åŠ¡ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | CPUå¯†é›†å‹ | I/Oå¯†é›†å‹ |

---

## 4. é¡¹ç›®å®è·µæ€»ç»“

### 4.1 é¡¹ç›®æ¶æ„

```
ç”¨æˆ·è¯·æ±‚
   â†“
main.py (å¼‚æ­¥ä¸»å‡½æ•°)
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. åˆå§‹åŒ–RAGç³»ç»Ÿ                â”‚
â”‚     - åŠ è½½Embeddingæ¨¡å‹          â”‚
â”‚     - åˆå§‹åŒ–ChromaDB             â”‚
â”‚     - æ‰¹é‡å¤„ç†æ–‡æ¡£ï¼ˆä¼˜åŒ–ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åˆ›å»ºAgents                   â”‚
â”‚     - AssistantAgent (AIåŠ©æ‰‹)   â”‚
â”‚     - UserProxyAgent (ç”¨æˆ·ä»£ç†) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ³¨å†Œå·¥å…·å‡½æ•°                 â”‚
â”‚     - query_knowledge_base       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ‰§è¡Œä»»åŠ¡ï¼ˆå¼‚æ­¥ï¼‰             â”‚
â”‚     - await run_fibonacci_task() â”‚
â”‚     - await run_qa_task()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…³é”®æŠ€æœ¯ç‚¹

#### 4.2.1 æ¨¡å—åŒ–è®¾è®¡

- **config/**: é…ç½®ç®¡ç†
- **rag/**: RAGç³»ç»Ÿ
- **agents/**: Agentç®¡ç†
- **tools/**: å·¥å…·å‡½æ•°
- **tasks/**: ä»»åŠ¡é€»è¾‘
- **utils/**: å·¥å…·ç±»

**ä¼˜åŠ¿**ï¼š
- ä»£ç æ¸…æ™°æ˜“ç»´æŠ¤
- åŠŸèƒ½ç‹¬ç«‹å¯å¤ç”¨
- æ˜“äºæ‰©å±•æ–°åŠŸèƒ½

#### 4.2.2 æ€§èƒ½ä¼˜åŒ–

**æ‰¹é‡å¤„ç†**ï¼š
```python
# åŸå§‹ç‰ˆæœ¬ï¼ˆæ…¢ï¼‰
for paragraph in paragraphs:
    embedding = model.encode(paragraph)  # è°ƒç”¨10æ¬¡
    collection.add(...)

# ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆå¿«ï¼‰
embeddings = model.encode(paragraphs)  # åªè°ƒç”¨1æ¬¡
collection.add(...)
```

**æå‡**: 3-5å€

#### 4.2.3 å¼‚æ­¥æ‰§è¡Œ

```python
# åŒæ­¥ç‰ˆæœ¬
def main():
    run_fibonacci_task()  # é˜»å¡
    run_qa_task()         # é˜»å¡

# å¼‚æ­¥ç‰ˆæœ¬
async def main():
    await run_fibonacci_task()  # éé˜»å¡
    await run_qa_task()         # éé˜»å¡
```

### 4.3 é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šå›¾ç‰‡ç”Ÿæˆå¤±è´¥

**åŸå› **: matplotlibçš„`plt.show()`åœ¨éäº¤äº’ç¯å¢ƒä¸­ä¼šé˜»å¡

**è§£å†³æ–¹æ¡ˆ**:
```python
import matplotlib
matplotlib.use('Agg')  # ä½¿ç”¨éäº¤äº’å¼åç«¯
plt.savefig('output.png')  # ä¿å­˜æ–‡ä»¶
# ç§»é™¤ plt.show()
```

#### é—®é¢˜2ï¼šåç¨‹æœªæ‰§è¡Œ

**åŸå› **: å¼‚æ­¥å‡½æ•°æ²¡æœ‰ä½¿ç”¨`await`

**è§£å†³æ–¹æ¡ˆ**:
```python
# âŒ é”™è¯¯
run_fibonacci_task()  # åç¨‹æœªæ‰§è¡Œ

# âœ… æ­£ç¡®
await run_fibonacci_task()  # åç¨‹æ‰§è¡Œ
```

#### é—®é¢˜3ï¼šRAGæ€§èƒ½æ…¢

**åŸå› **: é€ä¸ªå¤„ç†æ–‡æ¡£

**è§£å†³æ–¹æ¡ˆ**: æ‰¹é‡å¤„ç†
```python
# ä½¿ç”¨batch_sizeå‚æ•°
init_rag_system(batch_size=32)
```

---

## 5. å­¦ä¹ å¿ƒå¾—

### 5.1 AutoGençš„ç†è§£

1. **å¤šæ™ºèƒ½ä½“åä½œ**: ä¸åŒAgentå„å¸å…¶èŒï¼ŒååŒå®Œæˆä»»åŠ¡
2. **å·¥å…·é›†æˆ**: é€šè¿‡æ³¨å†Œå·¥å…·å‡½æ•°æ‰©å±•Agentèƒ½åŠ›
3. **è‡ªåŠ¨åŒ–å¯¹è¯**: æ¡†æ¶è‡ªåŠ¨ç®¡ç†å¤šè½®å¯¹è¯æµç¨‹

**å…³é”®æ”¶è·**ï¼š
- ç†è§£äº†Agentçš„è§’è‰²åˆ†å·¥
- å­¦ä¼šäº†å¦‚ä½•æ³¨å†Œå’Œä½¿ç”¨å·¥å…·å‡½æ•°
- æŒæ¡äº†å¯¹è¯æµç¨‹çš„æ§åˆ¶

### 5.2 RAGçš„ç†è§£

1. **å‘é‡æ£€ç´¢**: å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œé€šè¿‡ç›¸ä¼¼åº¦æ£€ç´¢
2. **çŸ¥è¯†å¢å¼º**: è®©LLMèƒ½å¤Ÿè®¿é—®å¤–éƒ¨çŸ¥è¯†åº“
3. **æ‰¹é‡ä¼˜åŒ–**: æ‰¹é‡å¤„ç†å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½

**å…³é”®æ”¶è·**ï¼š
- ç†è§£äº†Embeddingçš„ä½œç”¨
- å­¦ä¼šäº†ä½¿ç”¨ChromaDBè¿›è¡Œå‘é‡æ£€ç´¢
- æŒæ¡äº†æ‰¹é‡å¤„ç†çš„ä¼˜åŒ–æŠ€å·§

### 5.3 å¼‚æ­¥ç¼–ç¨‹çš„ç†è§£

1. **éé˜»å¡æ‰§è¡Œ**: åœ¨ç­‰å¾…I/Oæ—¶å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡
2. **async/awaitè¯­æ³•**: ç®€æ´çš„å¼‚æ­¥ç¼–ç¨‹æ–¹å¼
3. **é€‚ç”¨åœºæ™¯**: I/Oå¯†é›†å‹ä»»åŠ¡ï¼ˆç½‘ç»œã€æ–‡ä»¶ã€æ•°æ®åº“ï¼‰

**å…³é”®æ”¶è·**ï¼š
- ç†è§£äº†åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«
- å­¦ä¼šäº†ä½¿ç”¨async/awaitè¯­æ³•
- æŒæ¡äº†å¼‚æ­¥å‡½æ•°çš„è°ƒç”¨æ–¹å¼

### 5.4 é¡¹ç›®å¼€å‘ç»éªŒ

1. **æ¨¡å—åŒ–è®¾è®¡**: å°†åŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—
2. **æ€§èƒ½ä¼˜åŒ–**: æ‰¹é‡å¤„ç†ã€å‡å°‘é‡å¤è°ƒç”¨
3. **é”™è¯¯å¤„ç†**: æ·»åŠ å¼‚å¸¸æ•è·å’ŒéªŒè¯
4. **æ–‡æ¡£ç¼–å†™**: è¯¦ç»†çš„æ³¨é‡Šå’Œæ–‡æ¡£

**å…³é”®æ”¶è·**ï¼š
- å­¦ä¼šäº†å¦‚ä½•ç»„ç»‡å¤§å‹é¡¹ç›®
- æŒæ¡äº†æ€§èƒ½ä¼˜åŒ–çš„æ€è·¯
- æå‡äº†ä»£ç è´¨é‡æ„è¯†

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [PyAutoGen æ–‡æ¡£](https://microsoft.github.io/autogen/)
- [ChromaDB æ–‡æ¡£](https://docs.trychroma.com/)
- [Python asyncio æ–‡æ¡£](https://docs.python.org/3/library/asyncio.html)

### é¡¹ç›®æ–‡ä»¶
- [æ€§èƒ½ä¼˜åŒ–è¯´æ˜.md](æ€§èƒ½ä¼˜åŒ–è¯´æ˜.md) - è¯¦ç»†çš„æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£
- [CLAUDE.md](CLAUDE.md) - é¡¹ç›®è§„èŒƒå’Œå¼€å‘æŒ‡å—
- [README.md](README.md) - é¡¹ç›®ä½¿ç”¨è¯´æ˜

---

## ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘

1. **æ·±å…¥AutoGen**:
   - å­¦ä¹ GroupChatï¼ˆå¤šAgentç¾¤èŠï¼‰
   - æ¢ç´¢æ›´å¤šAgentç±»å‹
   - ç ”ç©¶Agentçš„è®°å¿†æœºåˆ¶

2. **ä¼˜åŒ–RAGç³»ç»Ÿ**:
   - å°è¯•ä¸åŒçš„Embeddingæ¨¡å‹
   - å­¦ä¹ æ··åˆæ£€ç´¢ï¼ˆå‘é‡+å…³é”®è¯ï¼‰
   - ç ”ç©¶RerankingæŠ€æœ¯

3. **é«˜çº§å¼‚æ­¥ç¼–ç¨‹**:
   - å­¦ä¹ å¹¶å‘æ‰§è¡Œï¼ˆasyncio.gatherï¼‰
   - æŒæ¡å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
   - ç ”ç©¶å¼‚æ­¥ç”Ÿæˆå™¨

4. **é¡¹ç›®æ‰©å±•**:
   - æ·»åŠ æ›´å¤šä»»åŠ¡ç±»å‹
   - é›†æˆæ›´å¤šå·¥å…·å‡½æ•°
   - ä¼˜åŒ–ç”¨æˆ·äº¤äº’ä½“éªŒ

---

**æ€»ç»“**: é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ç³»ç»Ÿåœ°å­¦ä¹ äº†å¤šæ™ºèƒ½ä½“åä½œã€RAGæ£€ç´¢å¢å¼ºç”Ÿæˆå’Œå¼‚æ­¥ç¼–ç¨‹ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯ï¼Œä¸ä»…æŒæ¡äº†ç†è®ºçŸ¥è¯†ï¼Œæ›´é‡è¦çš„æ˜¯é€šè¿‡å®è·µç§¯ç´¯äº†å®è´µçš„å¼€å‘ç»éªŒã€‚è¿™äº›æŠ€æœ¯å°†ä¸ºæœªæ¥çš„AIåº”ç”¨å¼€å‘æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚

---

**ä½œè€…**: QSH
**å®Œæˆæ—¥æœŸ**: 2026-02-13
**é¡¹ç›®åœ°å€**: multiagent_QSH
